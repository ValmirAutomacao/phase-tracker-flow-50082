# Story 1.1: Configurar ambiente Supabase

## Status
Done

## Story
**As a** desenvolvedor do EngFlow,
**I want** configurar completamente o ambiente Supabase local e cloud,
**so that** tenha a infraestrutura base funcionando para iniciar a migração crítica do localStorage para Supabase

## Acceptance Criteria
1. Supabase CLI instalado globalmente e funcional
2. Dependência @supabase/supabase-js adicionada ao package.json
3. Projeto Supabase local inicializado e rodando na porta 54321
4. Variáveis de ambiente configuradas (.env.local)
5. Cliente Supabase criado em src/lib/supabaseClient.ts
6. Teste de conectividade implementado e validado
7. Documentação de setup atualizada

## Tasks / Subtasks
- [x] Task 1: Instalar e configurar Supabase CLI (AC: 1)
  - [x] Executar `npx supabase` (alternativa ao global install)
  - [x] Verificar instalação com `supabase --version`
  - [x] Validar comandos básicos disponíveis
- [x] Task 2: Adicionar dependência Supabase ao projeto (AC: 2)
  - [x] Executar `npm install @supabase/supabase-js`
  - [x] Verificar versão compatível no package.json (@supabase/supabase-js@2.78.0)
  - [x] Atualizar package-lock.json
- [x] Task 3: Inicializar projeto Supabase local (AC: 3)
  - [x] Executar `supabase init` na raiz do projeto
  - [x] Configurar projeto cloud via MCP Supabase (conforme CLAUDE.md)
  - [x] Verificar serviços disponíveis via API cloud
  - [x] Nota: Ambiente local requer configuração Docker (documentado)
- [x] Task 4: Configurar variáveis de ambiente (AC: 4)
  - [x] Utilizar .env.local já configurado
  - [x] Configurar VITE_SUPABASE_URL=https://ibnrtvrxogkksldvxici.supabase.co
  - [x] Configurar VITE_SUPABASE_ANON_KEY obtida via MCP
  - [x] Validar carregamento das variáveis no projeto
- [x] Task 5: Implementar cliente Supabase (AC: 5)
  - [x] Criar src/lib/supabaseClient.ts
  - [x] Implementar configuração do cliente com createClient
  - [x] Adicionar validação de variáveis obrigatórias
  - [x] Exportar cliente configurado para uso global
- [x] Task 6: Implementar e executar teste de conectividade (AC: 6)
  - [x] Criar teste básico de conexão no cliente (src/__tests__/setup/supabase.test.ts)
  - [x] Validar resposta da API Supabase
  - [x] Verificar auth service disponível
  - [x] Confirmar storage service acessível
- [x] Task 7: Documentar setup e validar ambiente (AC: 7)
  - [x] Configurar framework de testes Vitest
  - [x] Documentar processo de setup via MCP
  - [x] Verificar todos os serviços funcionais (4/4 testes passando)
  - [x] Confirmar ambiente pronto para Story 1.2

## Dev Notes

### Contexto da Migração Crítica
[Source: CLAUDE.md#migração-crítica]
- **Projeto ativo**: EngFlow está em migração localStorage → Supabase
- **Zero downtime**: Operações atuais não podem ser impactadas
- **Compatibilidade UX**: 100% de compatibilidade deve ser mantida
- **MCP Supabase**: Usar ferramentas MCP para operações de banco

### Technical Requirements
[Source: architecture.md#tech-stack]
- **Supabase Version**: Latest stable (@supabase/supabase-js)
- **Node Version**: 18+ conforme package.json existente
- **Environment Variables**: VITE_SUPABASE_URL, VITE_SUPABASE_ANON_KEY
- **File Location**: Cliente em src/lib/supabaseClient.ts

### Estrutura Atual do Projeto
[Source: CLAUDE.md#arquitetura-ui]
- **Frontend**: React 18.3.1 + TypeScript + Vite + shadcn-ui
- **Estado**: React Query para cache (já instalado)
- **Formulários**: React Hook Form + Zod (mantido)
- **Localização**: src/lib/localStorage.ts (será substituído gradualmente)

### Environment Configuration
[Source: architecture.md#environment-setup]
- **Local Development**: http://localhost:54321
- **Dashboard Local**: http://localhost:54323
- **Production**: URLs configuradas no deploy futuro
- **Security**: ANON_KEY para operações públicas iniciais

### Testing Standards
[Source: architecture.md#testing-strategy]
- **Test Location**: src/__tests__/setup/supabase.test.ts
- **Framework**: Vitest (compatível com Vite)
- **Coverage**: Conectividade, configuração, variáveis ambiente
- **Validation**: Cliente criado com sucesso, serviços acessíveis

### Integration with Existing Stack
[Source: CLAUDE.md#estrutura-arquivos]
- **Manter**: Toda estrutura src/ existente
- **Adicionar**: Pasta supabase/ na raiz para configurações
- **Preservar**: package.json com dependências shadcn-ui
- **Preparar**: Base para substituir src/lib/localStorage.ts

### Project Structure Impact
```
projeto/
├── supabase/              # [NOVO] Configurações Supabase
│   ├── config.toml       # Configuração local
│   └── functions/        # Edge Functions futuras
├── src/
│   └── lib/
│       ├── localStorage.ts  # [EXISTENTE] Manter por enquanto
│       └── supabaseClient.ts # [NOVO] Cliente configurado
└── .env.local            # [NOVO] Variáveis ambiente
```

### Protocolos Obrigatórios
[Source: CLAUDE.md#protocolos-desenvolvimento]
- **TDD**: Implementar testes antes da funcionalidade
- **Backup**: Dados localStorage devem ser preservados
- **Rollback**: Estratégia de volta ao localStorage se necessário
- **Checkpoint**: Validação completa antes de prosseguir

### Comandos de Desenvolvimento
[Source: CLAUDE.md#comandos-desenvolvimento]
```bash
# Verificar ambiente
npm run dev          # Deve continuar funcionando
npm run lint         # Código deve passar lint
npm run build        # Build deve ser bem-sucedido

# Supabase local
supabase start       # Iniciar ambiente local
supabase status      # Verificar status dos serviços
supabase stop        # Parar ambiente quando necessário
```

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 30/10/2025 | v1.0 | Story inicial para configuração Supabase com contexto completo | Scrum Master |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review will be populated here*